@{
    ViewData["Title"] = "Home Page";
}

@model ApplicationUser

<head>
    <a asp-controller="Konto" asp-action="SkapaKonto">Skapa en ny användare</a> <br>
    <a asp-controller="Konto" asp-action="LoggaInPaKontot">Logga in</a><br>
    <a asp-controller="Konto" asp-action="KontoInfoAnvandare">Konto information</a><br>
    <a asp-controller="Inlagg" asp-action="SkapaEttInlagg">Skapa ett inlägg</a>
    <a asp-controller="Inlagg" asp-action="VisaInlagg">VisaInlagg inlagg</a>
    <form method="post" action="/Konto/LoggaUtFranKonto">
        <button type="submit">Logga ut</button>
    </form>
</head>

<h3>Sök upp en användare</h3>

<input type="text" id="sokFalt" placeholder="Sök användare"/>
<ul id="resultatLista"></ul>

<div class="text-center">
    @if (User.Identity.IsAuthenticated && Model != null)
    {
        <p>Inloggad som: @Model.ForNamn @Model.EfterNamn</p>
        <img id="Profilbild" src="@Model.ProfilBildUrl" alt="Profilbild" 
        style="width: 150px; object-fit: cover; margin-top: 10px;">
        
    }
    <h1 class="display-4">Welcome för detta hej jag heter markus</h1> 
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

<script>
    document.getElementById("sokFalt").addEventListener("input", function() {
    var query = this.value;

    if (query.length === 0) {
        document.getElementById("resultatLista").innerHTML = "";
        return;
    }

    fetch(`/Konto/SokKonto?query=${query}`) // 🛠 Fixad backticks för template string
    .then(response => response.json())
    .then(data => {
        var resultatLista = document.getElementById("resultatLista");
        resultatLista.innerHTML = "";

        data.forEach(anvandare => {  // 🛠 Ändrat "data.foreach()" till "data.forEach()"
            var li = document.createElement("li");

            var lank = document.createElement("a");
            lank.href = "Konto/KontoInfo?id=" + anvandare.id;
            lank.textContent = `${anvandare.forNamn} ${anvandare.efterNamn}`; // 🛠 "anvandare" används korrekt här
            li.appendChild(lank);
            resultatLista.appendChild(li);
        });
    })
    .catch(error => console.error("Fel vid hämtning av data:", error));
});
</script>

